<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Paykassma Registration Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #ffffff;
      background: linear-gradient(90deg, rgba(255, 255, 255, 1) 2%, rgba(228, 242, 228, 1) 46%, rgba(255, 255, 232, 1) 99%);
    }
    .form-container {
      max-width: 650px;
      margin: 40px auto;
      border-radius: 20px;
      box-shadow: 0 3px 27px rgba(0, 0, 0, 0.1);
      padding: 40px;
    }
    .form-header {
      text-align: center;
      margin-bottom: 25px;
    }
    .form-header img {
      width: 55%;
      margin-bottom: 15px;
    }
    .form-header h1 {
      font-weight: 700;
      color: #1976d2;
      font-size: 24px;
    }
    .form-header p {
      font-size: 15px;
      color: #555;
    }
    .file-input {
      display: none;
    }
    .file-label {
      display: inline-block;
      padding: 40px;
      border: 2px solid #929191;
      border-radius: 10px;
      width: 100%;
      text-align: center;
      cursor: pointer;  
      color: #0288d1;
      background-color: #e1f5fe;
      transition: all 0.3s ease;
    }
    .file-label:hover {
      background-color: #b3e5fc;
    }
    .file-name {
      margin-top: 8px;
      display: block;
      font-size: 14px;
      color: #555;
    }
    #message {
      display: none;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <div class="form-container">
    <div class="form-header">
      <img src="uploads/logo.png" alt="Paykassma Logo" />
      <h1>PAYKASSMA</h1>
      <p>The registration form of Paykassma.</p>
    </div>

    <div id="message"></div>

    <form id="form" enctype="multipart/form-data">
      <div class="mb-3">
        <label class="form-label">Full Name*</label>
        <input type="text" class="form-control" name="Name" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Email*</label>
        <input type="email" class="form-control" name="Email" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Phone/Telegram Username*</label>
        <input type="text" class="form-control" name="Username" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Date OF Birth*</label>
        <input type="date" class="form-control" name="Date of brith" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Place of Birth*</label>
        <input type="text" class="form-control" name="Place of brith" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Address*</label>
        <input type="text" class="form-control" name="Address" required />
      </div>

      <div class="mb-3">
        <label class="form-label">National ID / Pan card / Aadhaar Card / Passport (Number)*</label>
        <input type="number" class="form-control" name="ID Number" required />
      </div>

      <!-- File 1 -->
      <div class="mb-3">
        <label class="form-label">A photo of your national ID card both side*</label>
        <label class="file-label" for="fileInput1">Choose a file...</label>
        <input type="file" class="file-input" id="fileInput1" name="NID Card" accept="image/*" required />
        <span class="file-name" id="fileNameDisplay1">No file selected</span>
      </div>

      <!-- File 2 -->
      <div class="mb-3">
        <label class="form-label">A selfie with your national ID card*</label>
        <label class="file-label" for="fileInput2">Choose a file...</label>
        <input type="file" class="file-input" id="fileInput2" name="NID Selfy" accept="image/*" required />
        <span class="file-name" id="fileNameDisplay2">No file selected</span>
      </div>

      <!-- Agent or Client -->
      <div class="mb-3">
        <label class="form-label">Would you like to work as a general client or as an agent ?</label><br />
        <label><input type="radio" name="Role" value="Agent" required /> Agent</label><br />
        <label><input type="radio" name="Role" value="General Client" required /> General Client</label>
      </div>

      <button type="submit" id="submit-button" class="btn btn-primary w-100">Submit</button>
    </form>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbza4vTZhAi7NZ38gCm84QiIhMxq8fs8Yci8b5JrefjB9RCkziDFjK5ynEKtRb5Eng1Q/exec";
    const form = document.getElementById("form");
    const messageDiv = document.getElementById("message");
    const submitButton = document.getElementById("submit-button");

    const fileInput1 = document.getElementById("fileInput1");
    const fileInput2 = document.getElementById("fileInput2");
    const fileNameDisplay1 = document.getElementById("fileNameDisplay1");
    const fileNameDisplay2 = document.getElementById("fileNameDisplay2");

    // File name preview
    fileInput1.addEventListener("change", () => {
      fileNameDisplay1.textContent = fileInput1.files[0]?.name || "No file selected";
    });
    fileInput2.addEventListener("change", () => {
      fileNameDisplay2.textContent = fileInput2.files[0]?.name || "No file selected";
    });

    // Convert file to base64
    async function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const data = reader.result.split(",");
          resolve({
            fileName: file.name,
            mimeType: data[0].match(/:(.*?);/)[1],
            data: data[1],
          });
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Form submit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      messageDiv.style.display = "block";
      messageDiv.textContent = "Submitting...";
      messageDiv.style.backgroundColor = "beige";
      messageDiv.style.color = "black";

      submitButton.disabled = true;

      try {
        const formData = new FormData(form);
        const obj = {};
        for (let [key, value] of formData.entries()) obj[key] = value;

        if (fileInput1.files.length > 0)
          obj.national_id_card = await fileToBase64(fileInput1.files[0]);
        if (fileInput2.files.length > 0)
          obj.selfie_with_id = await fileToBase64(fileInput2.files[0]);

        const response = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(obj),
          headers: { "Content-Type": "text/plain;charset=utf-8" },
        });

        const data = await response.json();
        if (data.status === "success") {
          messageDiv.textContent = "✅ Form submitted successfully!";
          messageDiv.style.backgroundColor = "#48c78e";
          messageDiv.style.color = "white";
          form.reset();
          fileNameDisplay1.textContent = "No file selected";
          fileNameDisplay2.textContent = "No file selected";
        } else {
          throw new Error(data.message || "Unknown error");
        }
      } catch (err) {
        console.error(err);
        messageDiv.textContent = "❌ Error: " + err.message;
        messageDiv.style.backgroundColor = "#f14668";
        messageDiv.style.color = "white";
      } finally {
        submitButton.disabled = false;
        setTimeout(() => (messageDiv.style.display = "none"), 4000);
      }
    });
  </script>
</body>
</html>
